<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Simple Portal</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;max-width:1000px;margin:20px auto;padding:0 16px;}
    header{display:flex;align-items:center;justify-content:space-between}
    h1{margin:0;font-size:1.4rem}
    button{padding:6px 10px}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border:1px solid #ddd;padding:8px;text-align:left}
    #chart{width:100%;height:300px}
  </style>
</head>
<body>
  <header>
    <h1>My Simple Portal</h1>
    <div>
      <button id="refresh">Refresh data</button>
    </div>
  </header>

  <main>
    <canvas id="chart"></canvas>
    <div id="table-container"></div>
  </main>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    async function loadData(){
      const r = await fetch('data.json');
      if(!r.ok) throw new Error('Cannot load data.json: ' + r.status);
      return r.json();
    }

    function renderTable(data){
      const container = document.getElementById('table-container');
      if(!Array.isArray(data) || data.length===0){ container.innerHTML = '<p>No data</p>'; return; }
      const keys = Object.keys(data[0]);
      let html = '<table><thead><tr>' + keys.map(k=>'<th>'+k+'</th>').join('') + '</tr></thead><tbody>';
      for(const row of data){
        html += '<tr>' + keys.map(k=>'<td>' + (row[k] ?? '') + '</td>').join('') + '</tr>';
      }
      html += '</tbody></table>';
      container.innerHTML = html;
    }

    function renderChart(data, chart){
      const byType = {};
      for(const r of data){
        const type = r.Type ?? r.type ?? 'Unknown';
        const value = Number(r.Value ?? r.value ?? 1);
        byType[type] = (byType[type] || 0) + (isNaN(value)?0:value);
      }
      const labels = Object.keys(byType);
      const values = labels.map(l=>byType[l]);
      const ctx = document.getElementById('chart').getContext('2d');
      if(chart){ chart.data.labels = labels; chart.data.datasets[0].data = values; chart.update(); return chart; }
      return new Chart(ctx,{
        type:'bar',
        data:{ labels, datasets:[{ label:'Value by Type', data: values }] },
        options:{ responsive:true, maintainAspectRatio:false }
      });
    }

    let myChart;
    async function refresh(){
      try{
        const data = await loadData();
        renderTable(data);
        myChart = renderChart(data, myChart);
      }catch(e){
        document.getElementById('table-container').innerHTML = '<p style="color:red;">'+e.message+'</p>';
        console.error(e);
      }
    }

    document.getElementById('refresh').addEventListener('click', refresh);
    refresh();
  </script>
</body>
</html>
